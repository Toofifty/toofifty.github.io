"use strict";function dist(e,t,o,n,i,s){return Math.sqrt((e-n)*(e-n)+(t-i)*(t-i)+(o-s)*(o-s))}function wikiLink(e,t){return'<a href="http://en.wikipedia.org/wiki/'+e+t+'">'+e+"</a>"}function initThreeJS(){scene=new THREE.Scene,projector=new THREE.Projector,camera=new THREE.PerspectiveCamera(30,ASPECT,.1,1e4),camera.position.set(-243,600,182),camera.lookAt(new THREE.Vector3(0,0,0)),controls=new THREE.OrbitControls(camera),controls.keyPanSpeed=70,controls.minDistance=200,controls.maxDistance=500,renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setSize(WIDTH,HEIGHT),renderer.setClearColor(COLOURS.clear),document.body.appendChild(renderer.domElement)}function initShaders(){composer=new THREE.EffectComposer(renderer),composer.addPass(new THREE.RenderPass(scene,camera)),horizontalBlur=new THREE.ShaderPass(THREE.HorizontalBlurShader),verticalBlur=new THREE.ShaderPass(THREE.VerticalBlurShader);var e=new THREE.ShaderPass(THREE.RGBShiftShader);verticalBlur.renderToScreen=!0,horizontalBlur.uniforms.h.value=0,verticalBlur.uniforms.v.value=0,e.uniforms.amount.value=4e-4,composer.addPass(e),composer.addPass(horizontalBlur),composer.assPass(verticalBlur)}function initScene(){var e=new THREE.PlaneGeometry(1e3,1e3,POINTS.x,POINTS.y),t=new THREE.DirectionalLight(COLOURS.light,.7),o=new THREE.HemisphereLight(COLOURS.hemi1,COLOURS.hemi2,1);wireframe=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:COLOURS.wire,wireframe:!0})),plane=new THREE.Mesh(e,new THREE.MeshLambertMaterial({color:COLOURS.plane,shading:THREE.FlatShading})),hitplane=new THREE.Mesh(new THREE.PlaneGeometry(1e3,1e3,1,1),new THREE.MeshBasicMaterial({transparent:!0,opacity:0})),wireframe.rotation.x=-Math.PI/2,wireframe.geometry.dynamic=!0,plane.rotation.x=-Math.PI/2,plane.geometry.dynamic=!0,hitplane.rotation.x=-Math.PI/2,scene.add(plane),scene.add(hitplane),t.position.set(500,1e3,500),scene.add(t),o.position.set(0,500,0),scene.add(o)}function updatePlanes(){var e,t,o,n,i,s,r,a,c=wireframe.geometry.vertices,l=plane.geometry.vertices;for(e=0;e<c.length;e++){for(o=c[e],o.z=0,t=0;t<nodes.length;t++)n=nodes[t],i=dist(o.x,o.y,0,n.box.position.x,-n.box.position.z,0),s=n.aoe,s>i&&(r=i/(4*Math.PI)-time/2,a=(s-i)/(2*s),o.z+=WAVE_HEIGHT*Math.sin(r)*a);i=dist(o.x,o.y,0,m3d.x,m3d.y,m3d.z),50>i&&(o.z-=50-i),l[e].z=o.z-2}plane.geometry.compuseFaceNormals(),plane.geometry.normalsNeedUpdate=!0,plane.geometry.verticesNeedUpdate=!0,wireframe.geometry.verticesNeedUpdate=!0}function updateNodes(e){var t;for(t=0;t<nodes.length;t++)nodes[t].box!=selectedBox&&(nodes[t].incrementTime(e),nodes[t].box.position.y=80+BOB_HEIGHT*Math.sin((nodes[t].time+4*t)/2),nodes[t].updateText()),nodes[t].box.rotation.y+=e}function updateBlur(e){isBlurred?(currentBlur-=e*BLUR_AMOUNT/BLUR_TIME,0>=currentBlur&&(currentBlur=0,isBlurred=!1,isBlurring=!1)):(currentBlur+=e*BLUR_AMOUNT/BLUR_TIME,currentBlur>=BLUR_AMOUNT&&(currentBlur=BLUR_AMOUNT,isBlurred=!0,isBlurring=!1)),horizontalBlur.uniforms.h.value=currentBlur,verticalBlur.uniforms.v.value=currentBlur}function showSlowMessage(){isOverHTML=!0,popup.className="popup",popup.style.position="absolute",popup.style.textAlign="center",popup.style.left=WIDTH/2-pbox.w/2+"px",popup.style.top=HEIGHT/2-pbox.h/2+"px",popup.style.width=pbox.w+"px",popup.style.height=pbox.h+"px",popup.style.zIndex="10",popup.style.webkitTransition="0.5s",popup.style.MozTransition="0.5s",popup.style.msTransition="0.5s",popup.style.OTransition="0.5s",popup.style.transition="0.5s",setTimeout(function(){popup.innerHTML="<h2>Oh no!</h2><hr><p>Your device seems to be struggling to show the animation.</p><p>Click inside this box to go to a less intensive page, or click outside to stay here.</p>"},500),hasShownSlow=!0,isShowingSlow=!0}function drawContent(){var e,t,o,n,i,s,r;for(e=0;e<nodes.length;e++)t=mouse.x*WIDTH/2+WIDTH/2,o=mouse.y*-HEIGHT/2+HEIGHT/2,lockedPos.x=t,lockedPos.y=o,n=nodes[e].width,o>HEIGHT/2?(i=Math.min(nodes[e].height,Math.max(o,HEIGHT-o))-10,o-=i):(i=Math.max(0,nodes[e].height-(HEIGHT-o)),o-=i),t>WIDTH/2&&(t-=n),s=o+"px",r=t+"px",content.style.width=n+"px",content.style.height=i+"px",content.style.position="fixed",content.style.left=r,content.style.right=s,content.innerHTML=nodes[e].getHTML()}function cursorIsInSlowMessage(){var e=mouse.x*WIDTH/2+WIDTH/2,t=mouse.y*-HEIGHT/2+HEIGHT/2;return e<WIDTH/2+pbox.w/2&&e>WIDTH/2-pbox.w/2&&t<HEIGHT/2+pbox.h/2&&t>HEIGHT/2-pbox.h/2}function cursorIsOutsideContent(){var e,t=mouse.x*WIDTH/2+WIDTH/2,o=mouse.y*-HEIGHT/2+HEIGHT/2;for(e=0;e<nodes.length;e++)if(nodes[e].box==selectedBox){if(lockedPos.y>HEIGHT/2){if(o<lockedPos.y-nodes[e].height||o>lockedPos.y)return!0}else if(o>lockedPos.y+nodes[e].height||o<lockedPos.y)return!0;if(lockedPos.x>WIDTH/2){if(t<lockedPos.x-nodes[e].width||t>lockedPos.x)return!0}else if(t>lockedPos.x+nodes[e].width||t<lockedPos.x)return!0}return!1}function boxIsIntersected(){return selectedBox===Node}function findIntersect(){if(!isLocked){var e,t=new THREE.Vector3(mouse.x,mouse.y,1),o=new THREE.Raycaster(camera.position,t.sub(camera.position).normalize()),n=o.intersectObjects(scene.children);for(projector.unprojectVector(t,camera),e=0;e<n.length;e++)n[e].object==hitplane&&(m3d.x=n[e].point.x,m3d.y=-n[e].point.z,m3d.z=n[e].point.y);n.length>0?(n[0].object!=selectedBox&&n[0].object!=wireframe&&(void 0!==selectedBox&&(selectedBox.material.color.setHex(selectedBox.currentHex),content.innerHTML=""),selectedBox=n[0].object,selectedBox.currentHex=selectedBox.material.color.getHex()),(n[0].object==wireframe||n[0].object==hitplane)&&(void 0!==selectedBox&&(selectedBox.material.color.setHex(selectedBox.currentHex),content.innerHTML=""),selectedBox=void 0)):void 0!==selectedBox&&(selectedBox.material.color.setHex(selectedBox.currentHex),content.innerHTML=""),void 0!==selectedBox&&drawContent()}}function onResize(){WIDTH=window.innerWidth,HEIGHT=window.innerHeight,ASPECT=WIDTH/HEIGHT,renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),camera.aspect=ASPECT,camera.updateProjectionMatrix()}function onMouseMove(){mouse.x=event.clientX/WIDTH*2-1,mouse.y=event.clientY/HEIGHT*2-1}function onKeyPress(){13==event.keyCode&&(isLocked=!isLocked)}function onMouseDown(){0!=event.button||void 0===selectedBox||isLocked&&!cursorIsOutsideContent()||(isLocked=!isLocked),hasShownSlow&&isShowingSlow&&(cursorIsInSlowMessage()?window.location="less_fancy.html":(popup.innerHTML="",isOverHTML=!1,popup.className-="popup",popup.style.webkitTransition="0.5s",popup.style.MozTransition="0.5s",popup.style.msTransition="0.5s",popup.style.OTransition="0.5s",popup.style.transition="0.5s",popup.style.width="10px",popup.style.height="10px",isShowingSlow=!1))}function update(){frame++,updatePlanes();var e=clock.getDelta();controls.update(e),updateNodes(e),time+=e,avFPS=frame/clock.elapsedTime,clock.elapsedTime>=2&&clock.elapsedTime<7&&controls.panLeft(-72*e*Math.sin((clock.elapsedTime-2)*Math.PI/5)),minFPS>avFPS&&clock.elapsedTime>10&&!hasShownSlow&&showSlowMessage(),((boxIsIntersected()||isOverHTML)&&!isBlurred||!boxIsIntersected()&&!isOverHTML&&isBlurred)&&(isBlurring=!0),isBlurring&&updateBlur(e)}function init(){window.addEventListener("resize",onResize,!1),window.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("keypress",onKeyPress,!1),window.addEventListener("mousedown",onMouseDown,!1),content=document.createElement("content"),document.body.appendChild(content),popup=document.createElement("popup"),popup.style.width="10px",popup.style.height="10px",document.body.appendChild(popup),clock=new THREE.Clock,frame=0,initThreeJS(),initShaders(),initScene()}function anim(){requestAnimationFrame(anim),update(),composer.render()}var MOVE_SPEED=100,LOOK_SPEED=.075,POINTS={x:64,y:64},BLUR_TIME=.2,BLUR_AMOUNT=1/512,WAVE_HEIGHT=40,BOB_HEIGHT=20,MAX_DISTANCE=100,COLOURS={clear:2105376,wire:6710886,plane:5673396,light:5673396,hemi1:0,hemi2:14438436,node:16777215},WIDTH=window.innerWidth,HEIGHT=window.innerHeight,ASPECT=WIDTH/HEIGHT,clock,scene,camera,projector,renderer,composer,wireframe,plane,hitplane,horizontalBlur,verticalBlur,content,popup,pbox={w:400,h:175},controls,nodes=[],frame,time,avFPS,minFPS=30,m3d={x:0,y:0,z:0},mouse={x:0,y:0},currentBlur=0,lockedPos={x:0,y:0},hasShownSlow=!1,isShowingSlow=!1,isBlurring=!1,isBlurred=!1,isOverHTML=!1,isLocked=!1,selectedBox;Node=function(e,t,o,n,i,s,r,a,c,l){this.box=null,this.text=null,this.x=e,this.y=t,this.size=i,this.aoe=n,this.width=c,this.height=l,this.time=0,this.createBox=function(){this.box=new THREE.Mesh(new THREE.BoxGeometry(this.size,this.size,this.size),new THREE.MeshBasicMaterial({color:COLOURS.node})),this.box.position.set(e,50,t),scene.add(this.box)},this.createText=function(){this.text=new THREE.Mesh(new THREE.TextGeometry("   "+o,{size:this.size,height:this.size/5,curveSegments:2}),new THREE.MeshBasicMaterial({color:COLOURS.node})),this.text.position.set(e,0,t),scene.add(this.text)},this.updateText=function(){this.text.position.y=this.box.position.y,this.text.rotation.set(camera.rotation.x,camera.rotation.y,camera.rotation.z+.1)},this.incrementTime=function(e){this.time+=e},this.getHTML=function(){return'<div class="content"><h2>'+s+'</h2><hr><img src="img/'+r+'" alt="'+s+'" class="cimg"><p>'+a+"</p></div>"},this.createBox(),this.createText(),this.updateText()},init(),anim();